## 功能介绍 ##
监控日志，根据定义的规则，发送报警信息<br />
1、同时监控多个日志文件，并发送报警信息<br />
2、自定义监控关键字、监控的时间间隔、关键字出现阀值、关键字差量变化<br />
3、监控锁功能，为防止频繁告警，监控的日志发送报警之后，会对发送邮件功能上锁<br />

## 使用文档 ##
监控日志，根据定义的规则，发送报警信息<br />
1、同时监控多个日志文件，并发送报警信息<br />
2、自定义监控关键字、监控的时间间隔、关键字出现阀值、关键字差量变化<br />
3、监控锁功能，为防止频繁告警，监控的日志发送报警之后，会对发送邮件功能上锁<br />

## 使用文档 ##

把脚本复制到应用服务器脚本目录下，打开脚本，编辑如下变量<br />
参数解读：监控/data/log/java_api/error.log日志文件，如果在60秒之内出现5个ERROR字符，那么就发送报警邮件给OPS中的邮箱
<pre><code># 获取监控服务器主机名
hostname=`hostname`
# 监控的日志文件，多个文件用空格分隔
LOG_FILE="/data/log/java_api/error.log"
# 历史error数量记录目录
LOG_HIS_COUNT_DIR="/data/log_jk/log_his_count/"
# 当前error数量记录目录
LOG_CUR_COUNT_DIR="/data/log_jk/log_cur_count/"
# 错误日志结尾文件存放目录
LOG_MAIL_DIR="/data/log_jk/log_mail/"
# 锁文件目录
LOG_LOCK_DIR="/data/log_jk/log_lock/"
# 发送日志文件的后多少行
line=300
# 监控的时间间隔
mon_time=60
# 报警邮箱
OPS="xxx@xxx.com"
# 监控阀值
num=5
# 关键字
Keyword=ERROR</code></pre>

脚本执行：在应用服务器，切换到脚本存在目录，使用nohup命令使脚本运行在后台
<pre><code>[root@tomcat-01 ~]# cd /shell/
[root@tomcat-01 shell]# nohup /bin/sh log_jk.sh &</code></pre>

脚本运行后，一旦指定的关键字，在指定时间内，出现的次数超过阀值，就会发送报警邮件。

## 监控锁功能 ##
为了防止频繁发送邮件，在监控的日志发送报警邮件之后，会对次日志报警功能进行上锁（如果监控了多个日志，则会锁定故障日志的报警功能），如果没有解锁，就算监控阀值触发了报警，也不会发送报警邮件。

锁功能的实现是在脚本定义的LOG\_LOCK\_DIR目录下，创建和监控日志同名的文件（发送邮件后创建），如果需要开锁，锁文件会在邮件中发出,只需要删除锁文件就会重新开启报警功能。

