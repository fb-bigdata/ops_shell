## 功能介绍
把gitlab中php代码自动部署到web服务器

## 设计文档
### 1、获取代码
在部署服务器使用先使用git checkout master切换到master分支，在使用git pull 命令拉取最新的代码到本地，然后checkout到需要部署到服务器的tag。<br />
ps：脚本中git_pro函数在最后一行定义了cd $CODE_DIR && git pull，就是说用户传入的不是tag而是一个分支名称，可以拉取这个分支最新的代码进行部署，比如部署dev分支最新代码到web服务器，或者部署master分支最新代码到web服务器。如果只允许传入tag则删除此脚本。
### 2、推送代码到服务器
由于php是解释型语言，所以获取到需要部署的代码直接使用rsync和线上的代码比较差异进行替换即可。如果有需要过滤的文件，比如数据库配置文件，缓存目录这些不需要部署的。在rsync推送名录中使用--exclude选项添加过滤文件即可。
## 脚本执行依赖环境
1、可以免密钥拉取gitlab服务器代码。<br />
2、可以免密钥使用rsync命令推送代码到web服务器。

## 脚本使用

### 发布代码
使用sh命令执行脚本，传入deploy tag参数，比如我要部署的tag版本为3.4.5，那么脚本执行如下
```
sh project.sh deploy 3.4.5
```
### 回滚代码
如果刚才发布的tag 3.4.5 版本存在bug 需要回滚代码，理论应该回滚到上一个tag也就是3.4.4 版本，那么执行方式如下：
```
sh project.sh deploy 3.4.4
```